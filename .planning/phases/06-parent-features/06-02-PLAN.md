---
phase: 06-parent-features
plan: 02
type: execute
---

<objective>
Implement video management for parents to add/remove approved videos and time limit controls per player.

Purpose: Give parents control over which videos children can watch and enforce daily screen time limits.
Output: Video management screen with add/remove functionality, time limit settings with persistence.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior work:**
@.planning/phases/06-parent-features/06-01-SUMMARY.md

**Key files:**
@BennieGame/BennieGame/Features/Video/VideoSelectionView.swift
@BennieGame/BennieGame/Features/Parent/ParentDashboardView.swift
@BennieGame/BennieGame/Core/State/PlayerStore.swift
@BennieGame/BennieGame/Core/State/PlayerData.swift

**Current video implementation:**
- ApprovedVideo struct defined in VideoSelectionView.swift
- Hardcoded list of 6 German kids' videos
- No persistence or editing capability

**Design constraints (from PLAYBOOK):**
- Graceful time limit enforcement (no harsh cutoffs)
- German-only UI
- Touch targets ≥96pt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoStore and VideoManagementView</name>
  <files>BennieGame/BennieGame/Core/Services/VideoStore.swift, BennieGame/BennieGame/Features/Parent/VideoManagementView.swift, BennieGame/BennieGame/Features/Video/VideoSelectionView.swift, BennieGame.xcodeproj/project.pbxproj</files>
  <action>
1. Create VideoStore.swift:
```swift
@Observable
final class VideoStore {
    private(set) var approvedVideos: [ApprovedVideo]
    private let storageKey = "bennie.approved_videos"

    init() {
        self.approvedVideos = ApprovedVideo.defaultVideos
        load()
    }

    func addVideo(youtubeId: String, title: String) {
        let video = ApprovedVideo(id: youtubeId, title: title)
        approvedVideos.append(video)
        save()
    }

    func removeVideo(id: String) {
        approvedVideos.removeAll { $0.id == id }
        save()
    }

    func resetToDefaults() {
        approvedVideos = ApprovedVideo.defaultVideos
        save()
    }

    // Persistence with UserDefaults (same pattern as PlayerStore)
}
```

2. Move ApprovedVideo model to its own file or extend with Codable:
   - Make ApprovedVideo Codable for persistence
   - Keep defaultVideos as static property
   - Keep thumbnailURL computed property

3. Create VideoManagementView.swift:
   - List of current approved videos with thumbnails
   - Delete button (swipe-to-delete or X button)
   - Add video section:
     - TextField for YouTube video ID
     - TextField for title
     - "Hinzufügen" (Add) button
   - "Zurücksetzen" button to restore defaults
   - All touch targets ≥96pt

4. Update VideoSelectionView.swift:
   - Add @Environment(VideoStore.self) private var videoStore
   - Replace ApprovedVideo.approvedVideos with videoStore.approvedVideos
   - Remove hardcoded list (keep defaultVideos in model)

5. Inject VideoStore in BennieGameApp.swift environment

6. Add navigation from ParentDashboardView to VideoManagementView

Add all new files to Xcode project.pbxproj.
  </action>
  <verify>xcodebuild build succeeds, videos can be added and removed, changes persist</verify>
  <done>Video management allows parent control over approved video list with persistence</done>
</task>

<task type="auto">
  <name>Task 2: Create ParentSettings and TimeSettingsView</name>
  <files>BennieGame/BennieGame/Core/Services/ParentSettings.swift, BennieGame/BennieGame/Features/Parent/TimeSettingsView.swift, BennieGame/BennieGame/Features/Video/VideoPlayerView.swift, BennieGame.xcodeproj/project.pbxproj</files>
  <action>
1. Create ParentSettings.swift:
```swift
@Observable
final class ParentSettings {
    /// Daily video time limit in minutes (0 = unlimited)
    var dailyTimeLimitMinutes: Int = 30

    /// Track video time watched today per player
    private(set) var timeWatchedToday: [String: Int] = [:]

    /// Whether time limits are enabled
    var timeLimitsEnabled: Bool = true

    private let storageKey = "bennie.parent_settings"

    init() { load() }

    func recordTimeWatched(playerId: String, minutes: Int) {
        timeWatchedToday[playerId, default: 0] += minutes
        save()
    }

    func remainingTimeToday(for playerId: String) -> Int {
        guard timeLimitsEnabled, dailyTimeLimitMinutes > 0 else { return Int.max }
        let watched = timeWatchedToday[playerId] ?? 0
        return max(0, dailyTimeLimitMinutes - watched)
    }

    func resetDailyTracking() {
        timeWatchedToday = [:]
        save()
    }

    // Persistence with UserDefaults
}
```

2. Create TimeSettingsView.swift:
   - Toggle for enabling/disabling time limits
   - Stepper/picker for daily limit (15, 30, 45, 60 minutes, or unlimited)
   - Per-player override options (optional - can show current usage)
   - "Tageszeit zurücksetzen" button
   - German labels throughout

3. Update VideoPlayerView.swift for graceful time enforcement:
   - Check remaining time when entering video player
   - If remainingTime < requestedTime, cap the session
   - Record time watched when video ends (call recordTimeWatched)
   - Show warning if approaching daily limit

4. Wire TimeSettingsView navigation from ParentDashboardView

5. Inject ParentSettings in BennieGameApp.swift environment

Add all new files to Xcode project.pbxproj.
  </action>
  <verify>xcodebuild build succeeds, time limits can be configured, limits are enforced gracefully</verify>
  <done>Time settings functional with daily limits enforced across sessions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild build succeeds without errors
- [ ] VideoStore persists video list changes
- [ ] Videos can be added with YouTube ID and title
- [ ] Videos can be removed from approved list
- [ ] Time limits can be configured per day
- [ ] Time limits are enforced gracefully
- [ ] Settings persist across app restarts
- [ ] All UI is German-only
- [ ] Phase 6 complete
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Parents can manage approved video list
- Parents can set and enforce daily time limits
- All settings persist correctly
- Phase 6 (Parent Features) complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-parent-features/06-02-SUMMARY.md` with:
- Video management implementation
- Time limit enforcement approach
- Files created/modified
- Phase 6 completion status
</output>
