---
phase: 03-activities
plan: 03
type: execute
---

<objective>
Implement the Würfel (Dice) activity - a number recognition game with dice.

Purpose: First Zahlen activity where children identify the number shown on a dice by tapping the matching number button.
Output: WuerfelView with animated dice, number buttons 1-6, validation, and success feedback.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-activities/03-01-SUMMARY.md
@.planning/phases/03-activities/03-02-SUMMARY.md

**Key files:**
@BennieGame/BennieGame/Core/State/GameState.swift
@BennieGame/BennieGame/App/AppCoordinator.swift
@BennieGame/BennieGame/App/ContentView.swift
@BennieGame/BennieGame/Features/Activities/Zahlen/ZahlenSelectionView.swift

**Tech available:** SwiftUI, @Observable, BennieColors, animations
**Established patterns:** Activity view structure from PuzzleMatchingView/LabyrinthView

**Game specifications (from FULL_ARCHIVE.md):**
- Dice shows random 1-6
- Number buttons in 3×2 grid below dice
- Player taps matching number
- Correct: success + next roll
- Wrong: gentle feedback "Das ist die [X]. Probier nochmal!"
- +1 coin per correct answer
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WuerfelView with dice and number buttons</name>
  <files>BennieGame/BennieGame/Features/Activities/Zahlen/WuerfelView.swift</files>
  <action>
Create WuerfelView with:

1. Navigation header: Home button, ProgressBar, Volume toggle

2. Dice display (top center):
   - Large dice face (150×150pt)
   - White background with rounded corners
   - Black dots showing current value (1-6)
   - Use standard dice dot patterns:
     - 1: center dot
     - 2: top-right, bottom-left
     - 3: diagonal (top-right, center, bottom-left)
     - 4: corners
     - 5: corners + center
     - 6: two columns of 3

3. Number buttons (below dice):
   - 3×2 grid layout
   - Row 1: 1, 2, 3
   - Row 2: 4, 5, 6
   - Each button: 96×96pt minimum (wood styled)
   - Large number text in center
   - Use WoodButton or similar styling

4. Game state:
   - currentDiceValue: Int (1-6)
   - isRolling: Bool - animation state
   - showFeedback: Bool - show result
   - feedbackIsCorrect: Bool - was answer right
   - score: Int - track correct answers in session

5. Stone tablet background for the number buttons area

6. Background: BennieColors.cream
7. German: No specific text needed, just numbers
  </action>
  <verify>xcodebuild -project BennieGame/BennieGame.xcodeproj -scheme BennieGame -destination 'platform=iOS Simulator,name=iPad Pro 13-inch (M4)' build 2>&1 | tail -20</verify>
  <done>WuerfelView renders with dice face showing dots, 6 number buttons in grid</done>
</task>

<task type="auto">
  <name>Task 2: Implement dice rolling and answer validation</name>
  <files>BennieGame/BennieGame/Features/Activities/Zahlen/WuerfelView.swift</files>
  <action>
Add game logic:

1. Dice rolling animation:
```swift
func rollDice() {
    isRolling = true
    // Animate through random values for 1 second
    Timer.scheduledTimer(withTimeInterval: 0.1, repeats: true) { timer in
        currentDiceValue = Int.random(in: 1...6)
        rollCount += 1
        if rollCount >= 10 {
            timer.invalidate()
            isRolling = false
            // Final random value
            currentDiceValue = Int.random(in: 1...6)
        }
    }
}
```

2. On view appear: roll dice automatically

3. Number button tap handler:
```swift
func handleNumberTap(_ number: Int) {
    guard !isRolling else { return }

    if number == currentDiceValue {
        // Correct!
        handleCorrectAnswer()
    } else {
        // Wrong - gentle feedback
        handleWrongAnswer(tapped: number)
    }
}
```

4. Correct answer flow:
   - Show brief success indicator (green flash, checkmark)
   - Award coin via playerStore.awardCoin()
   - Check celebration trigger
   - If no celebration: auto-roll next dice after 1s delay
   - Track consecutive correct answers

5. Wrong answer flow:
   - Show gentle feedback (NOT "Falsch")
   - Highlight the correct button briefly
   - Allow retry (don't advance)
   - No penalty, just encouragement

6. Visual feedback:
   - Correct: button flashes green (BennieColors.success)
   - Wrong: tapped button gently pulses, correct button glows

7. After 5-10 correct answers, return home or continue based on user preference
  </action>
  <verify>xcodebuild -project BennieGame/BennieGame.xcodeproj -scheme BennieGame -destination 'platform=iOS Simulator,name=iPad Pro 13-inch (M4)' build 2>&1 | tail -20</verify>
  <done>Dice rolls, number validation works, correct awards coin, wrong allows retry</done>
</task>

<task type="auto">
  <name>Task 3: Wire up navigation from ZahlenSelectionView</name>
  <files>BennieGame/BennieGame/Features/Activities/Zahlen/ZahlenSelectionView.swift, BennieGame/BennieGame/App/ContentView.swift</files>
  <action>
1. Update ZahlenSelectionView:
   - Make "Würfel" button functional
   - On tap: coordinator.startPlaying(.zahlen, .wuerfel)
   - Keep "Wähle die Zahl" as comingSoon for now

2. Update ContentView routing:
```swift
case .playing(let activityType, let subActivity):
    switch subActivity {
    case .puzzleMatching:
        PuzzleMatchingView()
    case .labyrinth:
        LabyrinthView()
    case .wuerfel:
        WuerfelView()
    default:
        PlayingPlaceholder(...)
    }
```

3. Ensure home navigation works from WuerfelView

4. Test full flow: Home → Zahlen → Würfel → play → earn coins → home
  </action>
  <verify>xcodebuild -project BennieGame/BennieGame.xcodeproj -scheme BennieGame -destination 'platform=iOS Simulator,name=iPad Pro 13-inch (M4)' build 2>&1 | tail -20</verify>
  <done>Full navigation works, Würfel activity playable from Zahlen selection</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild build` succeeds without errors
- [ ] WuerfelView displays dice with correct dot patterns for 1-6
- [ ] Number buttons 1-6 displayed in 3×2 grid
- [ ] All touch targets ≥ 96pt
- [ ] Dice rolling animation works
- [ ] Correct number tap awards +1 coin
- [ ] Wrong number tap shows gentle feedback, allows retry
- [ ] Celebration triggers at 5-coin intervals
- [ ] Navigation: Home → Zahlen → Würfel → play → Home
- [ ] No "Falsch" or negative feedback text
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors
- Würfel activity fully playable
- 3 of 4 activities now functional (Puzzle, Labyrinth, Würfel)
</success_criteria>

<output>
After completion, create `.planning/phases/03-activities/03-03-SUMMARY.md`:

# 03-03 Summary: Würfel (Dice) Activity

**[One-liner: what shipped]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [List with descriptions]

## Commits
- [List of commits]

## Verification
- [Checklist results]

## Notes
- [Any deviations or decisions]

## Next Step
Ready for 03-04-PLAN.md (Wähle die Zahl)
</output>
