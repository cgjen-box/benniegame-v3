---
phase: 03-activities
plan: 04
type: execute
---

<objective>
Implement the Wähle die Zahl activity - a number selection/tracing game.

Purpose: Second Zahlen activity where children select or trace numbers 1-10 based on audio prompts.
Output: WaehleZahlView with number display, selection validation, and success feedback.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-activities/03-01-SUMMARY.md
@.planning/phases/03-activities/03-02-SUMMARY.md
@.planning/phases/03-activities/03-03-SUMMARY.md

**Key files:**
@BennieGame/BennieGame/Core/State/GameState.swift
@BennieGame/BennieGame/App/AppCoordinator.swift
@BennieGame/BennieGame/App/ContentView.swift
@BennieGame/BennieGame/Features/Activities/Zahlen/ZahlenSelectionView.swift
@BennieGame/BennieGame/Features/Activities/Zahlen/WuerfelView.swift

**Tech available:** SwiftUI, @Observable, BennieColors, animations
**Established patterns:** Activity view structure from prior activities

**Game specifications (from FULL_ARCHIVE.md):**
- Numbers 1-10 displayed on stone tablet
- Layout: Row 1: 1,2,3,4 | Row 2: 5,6,7 | Row 3: 8,9,10
- Target number shown/spoken, player taps matching number
- Correct: success + next number
- Wrong: gentle feedback
- +1 coin per correct answer
- Optional: number tracing (MVP can be tap-only, tracing as enhancement)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WaehleZahlView with number display</name>
  <files>BennieGame/BennieGame/Features/Activities/Zahlen/WaehleZahlView.swift</files>
  <action>
Create WaehleZahlView with:

1. Navigation header: Home button, ProgressBar, Volume toggle

2. Target number display (top):
   - Large number showing what to find
   - Text: "Zeig mir die [N]!" (placeholder for voice)
   - Golden highlight around target number
   - Use BennieFont.number() for large display

3. Number grid (center, on stone tablet):
   - Stone tablet background
   - Numbers arranged:
     - Row 1: 1, 2, 3, 4
     - Row 2: 5, 6, 7
     - Row 3: 8, 9, 10
   - Each number in a tappable circular/rounded button
   - 80×80pt minimum touch targets
   - Numbers styled with BennieFont

4. Game state:
   - targetNumber: Int (1-10)
   - selectedNumber: Int? - what player tapped
   - showFeedback: Bool
   - feedbackIsCorrect: Bool
   - questionsAnswered: Int

5. Visual styling:
   - Stone tablet: gray textured background
   - Number buttons: wood-styled circles
   - Target number: glows golden
   - Correct answer: flashes green
   - Wrong answer: pulses gently

6. Background: BennieColors.cream
7. German text for prompts
  </action>
  <verify>xcodebuild -project BennieGame/BennieGame.xcodeproj -scheme BennieGame -destination 'platform=iOS Simulator,name=iPad Pro 13-inch (M4)' build 2>&1 | tail -20</verify>
  <done>WaehleZahlView displays target prompt and numbers 1-10 in correct layout</done>
</task>

<task type="auto">
  <name>Task 2: Implement number selection and validation</name>
  <files>BennieGame/BennieGame/Features/Activities/Zahlen/WaehleZahlView.swift</files>
  <action>
Add game logic:

1. On view appear: select random target number 1-10

2. Number tap handler:
```swift
func handleNumberTap(_ number: Int) {
    if number == targetNumber {
        handleCorrectAnswer()
    } else {
        handleWrongAnswer(tapped: number)
    }
}
```

3. Correct answer flow:
   - Flash tapped number green (BennieColors.success)
   - Award coin via playerStore.awardCoin()
   - Check celebration trigger
   - If no celebration: select new random target after 1s delay
   - Track progress (questionsAnswered++)

4. Wrong answer flow:
   - Gentle pulse on tapped number
   - Brief highlight on correct number (golden glow)
   - Allow retry (don't change target)
   - NO negative text - just visual guidance

5. Target number selection:
   - Random from 1-10
   - Avoid repeating same number twice in a row
   - Show prominently at top: "Zeig mir die [N]!"

6. Session flow:
   - After 5-10 correct answers, can return home or continue
   - Keep activity engaging without being repetitive

7. Accessibility:
   - Each number button has accessibility label "Zahl [N]"
   - Target display accessible
  </action>
  <verify>xcodebuild -project BennieGame/BennieGame.xcodeproj -scheme BennieGame -destination 'platform=iOS Simulator,name=iPad Pro 13-inch (M4)' build 2>&1 | tail -20</verify>
  <done>Number selection works, correct awards coin, wrong allows retry with guidance</done>
</task>

<task type="auto">
  <name>Task 3: Wire up navigation and complete Phase 3</name>
  <files>BennieGame/BennieGame/Features/Activities/Zahlen/ZahlenSelectionView.swift, BennieGame/BennieGame/App/ContentView.swift</files>
  <action>
1. Update ZahlenSelectionView:
   - Make "Wähle die Zahl" button functional
   - On tap: coordinator.startPlaying(.zahlen, .waehleZahl)
   - Both Zahlen activities now functional

2. Update ContentView routing to handle all 4 activities:
```swift
case .playing(let activityType, let subActivity):
    switch subActivity {
    case .puzzleMatching:
        PuzzleMatchingView()
    case .labyrinth:
        LabyrinthView()
    case .wuerfel:
        WuerfelView()
    case .waehleZahl:
        WaehleZahlView()
    }
```

3. Remove PlayingPlaceholder fallback (all 4 activities implemented)

4. Update ZahlenSelectionView styling:
   - Remove "comingSoon" from both buttons
   - Clean up placeholder appearance

5. Verify complete activity flow:
   - All 4 activities accessible from home
   - Rätsel: Puzzle, Labyrinth both work
   - Zahlen: Würfel, Wähle die Zahl both work
   - Coins awarded correctly
   - Celebrations trigger at milestones
  </action>
  <verify>xcodebuild -project BennieGame/BennieGame.xcodeproj -scheme BennieGame -destination 'platform=iOS Simulator,name=iPad Pro 13-inch (M4)' build 2>&1 | tail -20</verify>
  <done>All 4 activities fully playable, Phase 3 complete</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild build` succeeds without errors
- [ ] WaehleZahlView displays numbers 1-10 in correct layout
- [ ] Target number prompt visible: "Zeig mir die [N]!"
- [ ] All touch targets ≥ 80pt (acceptable for number grid)
- [ ] Correct number tap awards +1 coin
- [ ] Wrong number tap shows gentle feedback, allows retry
- [ ] Celebration triggers at 5-coin intervals
- [ ] Navigation: Home → Zahlen → Wähle die Zahl → play → Home
- [ ] All 4 activities (Puzzle, Labyrinth, Würfel, Wähle Zahl) accessible and playable
- [ ] No "Falsch" or negative feedback text anywhere
- [ ] Phase 3 Activities complete
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors
- All 4 activities fully playable with level/question progression
- Coin economy works across all activities
- Celebration system triggers correctly
- Phase 3 complete - ready for Phase 4 (Reward System)
</success_criteria>

<output>
After completion, create `.planning/phases/03-activities/03-04-SUMMARY.md`:

# 03-04 Summary: Wähle die Zahl Activity

**[One-liner: what shipped]**

## Accomplishments
- [Key outcomes]
- All 4 Phase 3 activities complete

## Files Created/Modified
- [List with descriptions]

## Commits
- [List of commits]

## Verification
- [Checklist results]

## Notes
- [Any deviations or decisions]

## Phase 3 Complete
All activities implemented:
- Puzzle Matching (03-01)
- Labyrinth (03-02)
- Würfel (03-03)
- Wähle die Zahl (03-04)

## Next Step
Phase 3 complete, ready for Phase 4: Reward System
</output>
