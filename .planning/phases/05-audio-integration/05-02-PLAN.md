---
phase: 05-audio-integration
plan: 02
type: execute
---

<objective>
Create NarratorService and BennieService wrappers with typed voice line methods, plus sound effect definitions.

Purpose: Provide type-safe, German-language audio API that activities and screens can call without knowing file names.
Output: NarratorService and BennieService with all voice line triggers, SoundEffect enum for effects.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior work:**
@.planning/phases/05-audio-integration/05-01-SUMMARY.md

**Key files:**
@BennieGame/BennieGame/Core/Services/AudioManager.swift
@BennieGame/BennieGame/App/BennieGameApp.swift

**Voice line requirements (from PLAYBOOK):**

**Narrator lines (calm, clear adult voice):**
- Loading: "Wir sind gleich bereit zum Spielen."
- Player selection: "Wie heisst du? Alexander oder Oliver?"
- Hello: "Hallo Alexander! Los geht's!" / "Hallo Oliver! Los geht's!"
- Home: "Was möchtest du spielen?"
- Puzzle: "Mach das Muster nach!"
- Labyrinth: "Hilf Bennie den Weg finden!"
- Dice: "Wirf den Würfel!" + "Zeig mir die [1-6]!"
- Numbers: "Zeig mir die [1-10]!"
- Film: "Film ab!"

**Bennie lines (warm, encouraging bear voice):**
- Greeting part 1: "Hi [Name], ich bin Bennie!"
- Greeting part 2: "Wir lösen Aktivitäten um YouTube zu schauen."
- Return: "Lösen wir noch mehr Aktivitäten. Dann können wir mehr YouTube schauen!"
- Locked: "Das ist noch gesperrt."
- Puzzle start: "Das packen wir!"
- Labyrinth wrong: "Da komme ich nicht durch."
- Various hints for activities (10s, 20s, 30s idle)
- Celebrations at 5, 10, 15, 20 coins
- Treasure messages
- Video countdown: "Noch eine Minute." / "Die Zeit ist um. Lass uns spielen!"

**Sound effects:**
- tap_wood: Button tap feedback
- success_chime: Correct answer
- coin_collect: Coin earned
- celebration_fanfare: Celebration overlay
- chest_open: Treasure opened
- gentle_boop: Wrong answer (gentle, not negative)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NarratorService with all narrator voice triggers</name>
  <files>BennieGame/BennieGame/Core/Services/NarratorService.swift, BennieGame.xcodeproj/project.pbxproj</files>
  <action>
Create NarratorService.swift that wraps AudioManager for narrator-specific voice lines:

```swift
import Foundation

@Observable
class NarratorService {
    private let audioManager: AudioManager

    init(audioManager: AudioManager) {
        self.audioManager = audioManager
    }

    // MARK: - Loading Screen
    func playLoadingComplete() {
        audioManager.playVoice("narrator_loading_complete")
    }

    // MARK: - Player Selection
    func playPlayerQuestion() {
        audioManager.playVoice("narrator_player_question")
    }

    func playHello(playerName: String) {
        let filename = playerName.lowercased() == "alexander"
            ? "narrator_hello_alexander"
            : "narrator_hello_oliver"
        audioManager.playVoice(filename)
    }

    // MARK: - Home
    func playHomeQuestion() {
        audioManager.playVoice("narrator_home_question")
    }

    // MARK: - Activities
    func playPuzzleStart() {
        audioManager.playVoice("narrator_puzzle_start")
    }

    func playLabyrinthStart() {
        audioManager.playVoice("narrator_labyrinth_start")
    }

    func playDiceStart() {
        audioManager.playVoice("narrator_dice_start")
    }

    func playShowNumber(_ number: Int) {
        guard (1...6).contains(number) else { return }
        audioManager.playVoice("narrator_show_number_\(number)")
    }

    func playChooseNumber(_ number: Int) {
        guard (1...10).contains(number) else { return }
        audioManager.playVoice("narrator_choose_number_\(number)")
    }

    // MARK: - Video
    func playFilmAb() {
        audioManager.playVoice("narrator_film_ab")
    }

    // MARK: - Success Pool (random selection)
    private let successPhrases = [
        "success_super", "success_toll", "success_wunderbar",
        "success_genau", "success_super_gemacht", "success_perfekt", "success_bravo"
    ]
    private var recentSuccess: [String] = []

    func playRandomSuccess() {
        // Avoid repeating last 3 phrases
        let available = successPhrases.filter { !recentSuccess.contains($0) }
        guard let phrase = available.randomElement() else { return }

        recentSuccess.append(phrase)
        if recentSuccess.count > 3 { recentSuccess.removeFirst() }

        audioManager.playVoice(phrase)
    }
}
```

All methods call audioManager.playVoice with the correct filename.
Files won't exist yet (graceful degradation), but the service API is ready.
Add to Xcode project.
  </action>
  <verify>xcodebuild build succeeds, NarratorService has all voice trigger methods</verify>
  <done>NarratorService created with typed methods for all narrator voice lines</done>
</task>

<task type="auto">
  <name>Task 2: Create BennieService with all Bennie voice triggers</name>
  <files>BennieGame/BennieGame/Core/Services/BennieService.swift, BennieGame.xcodeproj/project.pbxproj</files>
  <action>
Create BennieService.swift that wraps AudioManager for Bennie-specific voice lines:

```swift
import Foundation

@Observable
class BennieService {
    private let audioManager: AudioManager

    init(audioManager: AudioManager) {
        self.audioManager = audioManager
    }

    // MARK: - Home Screen
    func playGreetingPart1(playerName: String) {
        // "Hi [Name], ich bin Bennie!"
        let filename = playerName.lowercased() == "alexander"
            ? "bennie_greeting_alexander_part1"
            : "bennie_greeting_oliver_part1"
        audioManager.playVoice(filename)
    }

    func playGreetingPart2() {
        audioManager.playVoice("bennie_greeting_part2")
    }

    func playReturnPart1() {
        audioManager.playVoice("bennie_return_part1")
    }

    func playReturnPart2() {
        audioManager.playVoice("bennie_return_part2")
    }

    func playLocked() {
        audioManager.playVoice("bennie_locked")
    }

    // MARK: - Activities
    func playPuzzleStart() {
        audioManager.playVoice("bennie_puzzle_start")
    }

    func playLabyrinthStart() {
        audioManager.playVoice("bennie_labyrinth_start")
    }

    func playLabyrinthWrong() {
        audioManager.playVoice("bennie_labyrinth_wrong")
    }

    func playWrongNumber() {
        audioManager.playVoice("bennie_wrong_number")
    }

    // MARK: - Hints (idle timeouts)
    func playPuzzleHint10s() {
        audioManager.playVoice("bennie_puzzle_hint_10s")
    }

    func playPuzzleHint20s() {
        audioManager.playVoice("bennie_puzzle_hint_20s")
    }

    func playLabyrinthHint() {
        audioManager.playVoice("bennie_labyrinth_hint")
    }

    func playDiceHint10s() {
        audioManager.playVoice("bennie_dice_hint_10s")
    }

    func playDiceHint20s() {
        audioManager.playVoice("bennie_dice_hint_20s")
    }

    func playDiceHint30s() {
        audioManager.playVoice("bennie_dice_hint_30s")
    }

    func playChooseHint10s() {
        audioManager.playVoice("bennie_choose_hint_10s")
    }

    func playChooseHint20s() {
        audioManager.playVoice("bennie_choose_hint_20s")
    }

    // MARK: - Celebration
    func playCelebration(coins: Int) {
        let milestone = (coins / 5) * 5
        switch milestone {
        case 5: audioManager.playVoice("bennie_celebration_5")
        case 10: audioManager.playVoice("bennie_celebration_10")
        case 15: audioManager.playVoice("bennie_celebration_15")
        case 20: audioManager.playVoice("bennie_celebration_20")
        default: audioManager.playVoice("bennie_celebration_5")
        }
    }

    // MARK: - Treasure
    func playTreasureMessage(coins: Int) {
        if coins < 10 {
            audioManager.playVoice("bennie_treasure_under10")
        } else if coins < 20 {
            audioManager.playVoice("bennie_treasure_over10")
        } else {
            audioManager.playVoice("bennie_treasure_over20")
        }
    }

    // MARK: - Video
    func playOneMinuteWarning() {
        audioManager.playVoice("bennie_video_1min")
    }

    func playTimeUp() {
        audioManager.playVoice("bennie_video_timeup")
    }
}
```

Add to Xcode project.
  </action>
  <verify>xcodebuild build succeeds, BennieService has all voice trigger methods</verify>
  <done>BennieService created with typed methods for all Bennie voice lines</done>
</task>

<task type="auto">
  <name>Task 3: Create SoundEffect enum and convenience methods</name>
  <files>BennieGame/BennieGame/Core/Services/SoundEffects.swift, BennieGame.xcodeproj/project.pbxproj</files>
  <action>
Create SoundEffects.swift with typed sound effect enum:

```swift
import Foundation

/// Sound effects available in the game
enum SoundEffect: String, CaseIterable {
    case tapWood = "tap_wood"
    case successChime = "success_chime"
    case coinCollect = "coin_collect"
    case celebrationFanfare = "celebration_fanfare"
    case chestOpen = "chest_open"
    case gentleBoop = "gentle_boop"
    case pathDraw = "path_draw"

    var filename: String { rawValue }
}

// MARK: - AudioManager Extension
extension AudioManager {
    func playEffect(_ effect: SoundEffect) {
        playEffect(effect.filename)
    }
}
```

This provides type-safe sound effect access. Views can call:
`audioManager.playEffect(.successChime)`

Add to Xcode project.
  </action>
  <verify>xcodebuild build succeeds, SoundEffect enum compiles, AudioManager extension works</verify>
  <done>SoundEffect enum created with all game sound effects defined</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild build succeeds without errors
- [ ] NarratorService.swift exists with all narrator triggers
- [ ] BennieService.swift exists with all Bennie triggers
- [ ] SoundEffects.swift exists with SoundEffect enum
- [ ] All services compile and can be instantiated
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- NarratorService has all narrator voice methods
- BennieService has all Bennie voice methods
- SoundEffect enum covers all game effects
- Type-safe audio API ready for integration
</success_criteria>

<output>
After completion, create `.planning/phases/05-audio-integration/05-02-SUMMARY.md` with:
- Voice service architecture
- List of all voice triggers defined
- Sound effects defined
- Files created
</output>
