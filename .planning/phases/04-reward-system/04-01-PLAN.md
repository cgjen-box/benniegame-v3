---
phase: 04-reward-system
plan: 01
type: execute
---

<objective>
Enhance coin award animations and progress bar visualization for satisfying reward feedback.

Purpose: Make earning coins feel rewarding with visual animations that reinforce positive behavior.
Output: Animated coin collection with progress bar updates that children can see and understand.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-activities/03-04-SUMMARY.md

**Key files:**
@BennieGame/BennieGame/Design/Components/ProgressBar.swift
@BennieGame/BennieGame/Core/State/PlayerStore.swift
@BennieGame/BennieGame/App/AppCoordinator.swift

**Tech stack available:**
- SwiftUI with @Observable pattern
- Lottie for animations (already imported)
- BennieColors design system
- BennieFont typography system

**Established patterns:**
- Activities call playerStore.awardCoin() on correct answers
- coordinator.shouldShowCelebration(for:) checks for 5-coin intervals
- coordinator.showCelebration(coinsEarned:) triggers celebration state

**Constraining decisions:**
- Coin economy: +1 coin per correct answer (already implemented)
- Celebration at 5, 10, 15, 20... coins (interval logic exists)
- German only UI, positive feedback only
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CoinFlyAnimation component</name>
  <files>BennieGame/BennieGame/Design/Components/CoinFlyAnimation.swift, BennieGame.xcodeproj/project.pbxproj</files>
  <action>
Create a SwiftUI view that shows an animated coin flying from a source point to the progress bar.
- Use withAnimation for smooth arc trajectory (0.8s duration)
- Golden circle with "ðŸª™" or custom coin design using BennieColors.coinGold
- Add scale animation (start large, shrink as it lands)
- Optional sparkle trail using small circles that fade
- Accept start position as parameter, animate to top-right where progress bar lives
- Use @State for position/opacity to control animation phases
- Add onComplete callback to notify when animation finishes

Add file to Xcode project.pbxproj following established pattern (PBXBuildFile, PBXFileReference, group, Sources phase).
  </action>
  <verify>xcodebuild build succeeds, component visible in SwiftUI previews</verify>
  <done>CoinFlyAnimation renders and animates coin from source to target position with 0.8s arc trajectory</done>
</task>

<task type="auto">
  <name>Task 2: Enhance ProgressBar with coin slot animation</name>
  <files>BennieGame/BennieGame/Design/Components/ProgressBar.swift</files>
  <action>
Enhance ProgressBar to animate when coins are added:
- Add @State var animatingSlot: Int? to track which slot is animating
- When currentCoins changes, briefly highlight the new coin slot with BennieColors.coinGold glow
- Use withAnimation(.spring()) for fill animation
- Show mini treasure chest icon when coins reach 10 and 20 (existing placeholder concept)
- Add subtle pulse effect on newly filled slot (scale 1.0 â†’ 1.1 â†’ 1.0)

The ProgressBar already shows coin count - enhance it to feel alive when earning coins.
Do NOT change the overall layout or structure, just add animation polish.
  </action>
  <verify>xcodebuild build succeeds, ProgressBar preview shows animation when coin count changes</verify>
  <done>ProgressBar animates fill with spring physics, new coin slot glows briefly, chest icons appear at 10/20 milestones</done>
</task>

<task type="auto">
  <name>Task 3: Wire coin animation into activity completion flow</name>
  <files>BennieGame/BennieGame/Features/Activities/Raetsel/PuzzleMatchingView.swift, BennieGame/BennieGame/Features/Activities/Raetsel/LabyrinthView.swift, BennieGame/BennieGame/Features/Activities/Zahlen/WuerfelView.swift, BennieGame/BennieGame/Features/Activities/Zahlen/WaehleZahlView.swift</files>
  <action>
Add coin fly animation to each activity's success handler:
- Add @State var showCoinAnimation = false to each activity view
- Add @State var coinStartPosition: CGPoint = .zero to track where coin animates from
- On correct answer, before calling playerStore.awardCoin():
  1. Store the position of the tapped element in coinStartPosition
  2. Set showCoinAnimation = true
  3. After animation completes (via callback), call playerStore.awardCoin() and check celebration
- Use GeometryReader sparingly to capture tap position (or use .position modifier)
- Add CoinFlyAnimation overlay to each view that triggers when showCoinAnimation is true

Keep the existing game logic intact - just add the animation layer on top.
  </action>
  <verify>xcodebuild build succeeds, correct answer in any activity shows coin flying to progress bar before celebration check</verify>
  <done>All 4 activities show coin fly animation on correct answer, animation completes before celebration check triggers</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild build succeeds without errors
- [ ] CoinFlyAnimation component created and added to project
- [ ] ProgressBar animates on coin changes with glow effect
- [ ] All 4 activities trigger coin animation on correct answer
- [ ] Animation timing feels satisfying (0.8s coin fly)
- [ ] Celebration still triggers correctly after animation
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Coin earning feels visually rewarding
- No disruption to existing game flow
- Animation performance smooth (60fps)
</success_criteria>

<output>
After completion, create `.planning/phases/04-reward-system/04-01-SUMMARY.md` with:
- Substantive summary of what was built
- Files created/modified
- Any decisions made about animation timing/style
- Verification that animations work in all activities
</output>
