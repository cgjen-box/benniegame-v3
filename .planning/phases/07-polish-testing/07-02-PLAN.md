---
phase: 07-polish-testing
plan: 02
type: execute
---

<objective>
Execute full playthrough testing from 0 to 20+ coins with persistence verification and edge case testing.

Purpose: Validate the complete user journey works end-to-end without crashes, with proper state persistence.
Output: Verified working app ready for TestFlight, all critical user flows tested.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior work:**
@.planning/phases/07-polish-testing/07-01-SUMMARY.md

**Key flows to test:**
1. Loading -> Player Selection -> Home (navigation)
2. Activity completion -> Coin award -> Celebration (reward loop)
3. 10 coins -> Treasure -> Video Selection -> Video Player (redemption)
4. Parent Gate -> Dashboard -> Settings (parent features)

**Key files:**
@BennieGame/BennieGame/Core/State/GameState.swift
@BennieGame/BennieGame/Core/State/PlayerStore.swift
@BennieGame/BennieGame/Core/State/PlayerData.swift
@BennieGame/BennieGame/App/AppCoordinator.swift
@BennieGame/BennieGame/App/ContentView.swift

**Persistence files:**
@BennieGame/BennieGame/Core/Services/VideoStore.swift
@BennieGame/BennieGame/Core/Services/ParentSettings.swift

**Success metrics from PROJECT.md:**
- Full playthrough 0->100 coins: Works without crashes
- Screen time stays structured: Parent controls work
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify build and run on simulator</name>
  <files>BennieGame.xcodeproj</files>
  <action>
1. Run full clean build:
   ```bash
   xcodebuild clean build \
     -project BennieGame/BennieGame.xcodeproj \
     -scheme BennieGame \
     -destination "platform=iOS Simulator,name=iPad (10th generation)" \
     CODE_SIGNING_ALLOWED=NO
   ```

2. Check for any warnings that should be addressed:
   - Deprecation warnings
   - Unused variable warnings
   - Potential memory issues

3. Verify all source files are included in project:
   - Check project.pbxproj references match actual files
   - No missing file references

4. Document any issues found and fix critical ones.
  </action>
  <verify>xcodebuild build succeeds with BUILD SUCCEEDED, no critical warnings</verify>
  <done>Clean build passes, app ready for simulator testing</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete app ready for full playthrough testing</what-built>
  <how-to-verify>
**Test the complete user journey on iPad Simulator:**

1. **Launch and Navigation:**
   - Open Xcode, run BennieGame scheme on iPad (10th gen) simulator
   - Loading screen appears with progress bar
   - Player selection shows Alexander and Oliver
   - Select Alexander -> Home screen appears

2. **Activity Flow (earn 5 coins):**
   - Tap "RÃ¤tsel" -> Select Puzzle activity
   - Complete one level -> Coin awarded (+1)
   - Repeat until 5 coins earned
   - Celebration overlay appears at 5 coins

3. **Continue to 10 coins:**
   - Play more levels or switch activities (Labyrinth, Dice, Choose Number)
   - Earn 5 more coins (total 10)
   - Celebration at 10 coins mentions YouTube

4. **Treasure Redemption:**
   - Tap treasure chest on home screen
   - "5 Min YouTube" button should be enabled
   - Tap it -> Video selection appears
   - Select a video -> Video plays with countdown
   - Time expires -> Returns to home

5. **Persistence Check:**
   - Note current coin count
   - Force quit simulator (Cmd+Q)
   - Relaunch app
   - Select same player -> Coins should persist

6. **Parent Features:**
   - Tap settings gear on home screen
   - Math gate appears (solve: X + Y = ?)
   - Enter correct answer -> Dashboard appears
   - View player stats, test reset functionality
   - Navigate to Video Management, Time Settings

7. **Edge Cases:**
   - Try selecting video with 0 coins (buttons disabled)
   - Try wrong answer in parent gate (shake, retry)
   - Switch players and verify separate coin counts

**Report any issues found:**
- Crashes
- Navigation problems
- Missing UI elements
- Incorrect behavior
  </how-to-verify>
  <resume-signal>Type "approved" if all flows work, or describe any issues found</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Fix any issues from playthrough testing</name>
  <files>Varies based on issues found</files>
  <action>
Based on checkpoint feedback, fix any issues found during playthrough:

**Common issues to watch for:**

1. **Navigation issues:**
   - Check AppCoordinator navigation methods
   - Verify GameState transitions are correct
   - Ensure all navigation paths complete

2. **Persistence issues:**
   - Verify PlayerStore save/load methods
   - Check UserDefaults keys are consistent
   - Test that data survives app restart

3. **UI issues:**
   - Missing views or components
   - Layout problems on iPad
   - Touch target issues

4. **State management issues:**
   - Coin counts not updating
   - Celebration not triggering
   - Video time not tracking

5. **Parent feature issues:**
   - Math gate not validating correctly
   - Settings not persisting
   - Video list not updating

For each issue:
1. Identify root cause
2. Implement fix
3. Verify fix works
4. Commit with descriptive message

If no issues found, document that playthrough passed.
  </action>
  <verify>xcodebuild build succeeds, reported issues are fixed</verify>
  <done>All issues from playthrough testing resolved, or no issues found</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Clean build succeeds
- [ ] Full playthrough tested (0 -> 10+ coins)
- [ ] Coin earning and celebrations work
- [ ] YouTube redemption flow works
- [ ] Persistence verified across app restarts
- [ ] Parent features accessible and functional
- [ ] All reported issues fixed
- [ ] Phase 7 complete
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Full user journey works without crashes
- State persists across app restarts
- Parent controls functional
- App ready for TestFlight
- Phase 7 (Polish & Testing) complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish-testing/07-02-SUMMARY.md` with:
- Build verification results
- Playthrough test results
- Issues found and fixes applied
- Final readiness status
- Phase 7 completion confirmation
- Milestone completion: Project ready for TestFlight
</output>
